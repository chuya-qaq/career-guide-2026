<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 职业发展规划镜 - 2035版</title>
    <!-- 1. 引入 React 和 ReactDOM -->
    <script crossorigin src="https://lib.baomitu.com/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://lib.baomitu.com/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <!-- 2. 引入 Babel -->
    <script src="https://lib.baomitu.com/babel-standalone/7.22.17/babel.min.js"></script>
    <!-- 3. 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* 动画定义 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans selection:bg-emerald-500 selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 图标组件 ---
        const IconBase = ({ d, className = "w-5 h-5", viewBox = "0 0 24 24", fill="none", children }) => (
            <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox={viewBox} fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                {d ? <path d={d} /> : children}
            </svg>
        );

        const Icons = {
            Sparkles: (props) => <IconBase d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" {...props} />,
            User: (props) => <IconBase {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>,
            Heart: (props) => <IconBase d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" {...props} />,
            Target: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></IconBase>,
            Brain: (props) => <IconBase {...props}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></IconBase>,
            Cpu: (props) => <IconBase {...props}><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/></IconBase>,
            CheckCircle2: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></IconBase>,
            TrendingUp: (props) => <IconBase {...props}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></IconBase>,
            Map: (props) => <IconBase {...props}><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></IconBase>,
            AlertCircle: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>,
            Loader2: (props) => <IconBase d="M21 12a9 9 0 1 1-6.219-8.56" {...props} />,
            ShieldAlert: (props) => <IconBase {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>,
            Share2: (props) => <IconBase {...props}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></IconBase>,
            Menu: (props) => <IconBase {...props}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></IconBase>,
            RotateCcw: (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>,
            Wand2: (props) => <IconBase {...props}><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z"/><path d="m14 7 3 3"/><path d="M5 6v4"/><path d="M19 14v4"/><path d="M10 2v2"/><path d="M7 8H3"/><path d="M21 16h-4"/><path d="M11 3H9"/></IconBase>,
            Check: (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12"/></IconBase>,
            X: (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconBase>,
            Copy: (props) => <IconBase {...props}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></IconBase>
        };
        const _APP_SEC_TOKEN = "c2staGh2cnd0c3Jna2ZxY2VoenRjdHVkZWZ2bWd4ZGxraWdsd3Ryd3Jva2xteWV4b3h4";
        const getSecret = () => {
            try { return atob(_APP_SEC_TOKEN); } catch(e) { return ""; }
        };

        const MODEL_NAME = "deepseek-ai/DeepSeek-R1-Distill-Qwen-7B"; 

        const SYSTEM_PROMPT = `
你是一位基于大数据的2035年资深生涯规划师。
**最高指令：拒绝“强行关联”与“逻辑幻觉”。**

请执行以下流程：

1. **常识审查**: 检查输入是否有效。如果包含恶搞/生理本能（如吃饭睡觉），返回 type: "invalid"。
2. **职业匹配**: 从全球数据库检索 3 个 2035 年潜力职业。
   - 必须为每个职业计算一个**匹配度分值 (score)**，例如 "95%" 或 "88%"。
   - 匹配理由必须基于"技能迁移"理论。
3. **输出格式 (纯JSON)**:
{
  "type": "specific" 或 "invalid",
  "message": "简短分析",
  "careers": [
    {
      "title": "职业名称",
      "score": "匹配度数值(如 98%)",
      "desc": "职业定义",
      "matchReason": "技能迁移分析",
      "strengthMatch": "核心胜任力锚点",
      "growth": "行业急需技能",
      "path": "可行起步动作"
    }
  ]
}
`;

        function App() {
            const [step, setStep] = useState(1);
            const [inputs, setInputs] = useState({
                subjects: '', hobbies: '', problem: '', idols: '', superpower: '', expectation: ''
            });
            const [resultData, setResultData] = useState(null);
            const [errorMsg, setErrorMsg] = useState("");
            const [isCopied, setIsCopied] = useState(false);
            const [showResetModal, setShowResetModal] = useState(false);
            const [showShareModal, setShowShareModal] = useState(false);
            
            const resultRef = useRef(null);

            useEffect(() => {
                const savedData = localStorage.getItem('ai_career_mirror_v3_sf');
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        if (parsed.inputs) setInputs(parsed.inputs);
                        if (parsed.resultData) {
                            setResultData(parsed.resultData);
                            setStep(3);
                        }
                    } catch (e) { console.error("读取存档失败", e); }
                }
            }, []);

            useEffect(() => {
                if (step === 3 && resultData) {
                    localStorage.setItem('ai_career_mirror_v3_sf', JSON.stringify({ inputs, resultData }));
                }
            }, [resultData, step, inputs]);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setInputs(prev => ({ ...prev, [name]: value }));
            };

            const handleMagicFill = () => {
                setInputs({
                    subjects: '生物、化学、信息技术',
                    hobbies: '在家里种植水培植物，观察昆虫生态，玩《坎巴拉太空计划》',
                    problem: '去年夏天家里阳台的植物因为高温差点死掉，我设计了一个简易的自动滴灌装置，并用遮阳网调整了光照，最后救活了80%的植物。',
                    idols: '袁隆平、马斯克',
                    superpower: '对环境变化很敏感，动手能力强',
                    expectation: '希望能解决粮食危机，或者去外星种地'
                });
            };

            const callSiliconFlowAPI = async () => {
                setStep(2);
                setErrorMsg("");
                setResultData(null);

                const currentKey = getSecret();

                try {
                    const userPrompt = `
                        【学生真实画像数据】
                        - 偏好学科：${inputs.subjects}
                        - 深度爱好：${inputs.hobbies}
                        - 实际解决过的难题：${inputs.problem} (重点分析此项的逻辑复杂度)
                        - 自评特长：${inputs.superpower}
                        - 职业价值观：${inputs.expectation}
                        - 偶像：${inputs.idols}
                        
                        请严格根据 System Prompt 进行常识判断和职业推演。务必包含 score 字段。确保返回纯JSON。
                    `;

                    const response = await fetch("https://api.siliconflow.cn/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${currentKey}`
                        },
                        body: JSON.stringify({
                            model: MODEL_NAME,
                            messages: [
                                { role: "system", content: SYSTEM_PROMPT },
                                { role: "user", content: userPrompt }
                            ],
                            stream: false,
                            temperature: 0.7,
                            max_tokens: 2048
                        })
                    });

                    if (!response.ok) {
                        let errorMessage = `API 请求失败: ${response.status}`;
                        if (response.status === 403) {
                            throw new Error("权限校验失败 (403)。\n可能原因：\n1. 账号余额不足（部分免费模型也需少量余额激活）\n2. 实名认证状态延迟（刚认证需等待）\n3. API Key 权限受限");
                        }
                        
                        try {
                            const errData = await response.json();
                            if (errData.error && errData.error.message) {
                                errorMessage = errData.error.message;
                            }
                        } catch (e) {}

                        if (response.status === 401) errorMessage = "API 密钥无效 (401)。请检查代码中的配置。";
                        if (response.status === 429) errorMessage = "请求过于频繁 (429)。请稍后重试。";
                        
                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    let aiText = data.choices?.[0]?.message?.content;
                    if (!aiText) throw new Error("AI 未返回有效数据");

                    aiText = aiText.replace(/<think>[\s\S]*?<\/think>/g, '').trim();
                    const jsonMatch = aiText.match(/```json\n([\s\S]*?)\n```/) || aiText.match(/```([\s\S]*?)```/);
                    if (jsonMatch) {
                        aiText = jsonMatch[1];
                    }
                    const startIndex = aiText.indexOf('{');
                    const endIndex = aiText.lastIndexOf('}');
                    
                    if (startIndex !== -1 && endIndex !== -1) {
                        aiText = aiText.substring(startIndex, endIndex + 1);
                    } else {
                        throw new Error("AI 返回的内容不符合 JSON 格式，请重试。");
                    }

                    const parsedData = JSON.parse(aiText);
                    setResultData(parsedData);
                    setStep(3);

                } catch (err) {
                    console.error("AI Error:", err);
                    setErrorMsg(`${err.message}`);
                    setStep(4);
                }
            };

            const confirmReset = () => {
                localStorage.removeItem('ai_career_mirror_v3_sf');
                setResultData(null);
                setErrorMsg("");
                setInputs({ subjects: '', hobbies: '', problem: '', idols: '', superpower: '', expectation: '' });
                setStep(1);
                setShowResetModal(false);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                } catch (err) {
                    // Fallback for older browsers or non-secure contexts
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        setIsCopied(true);
                        setTimeout(() => setIsCopied(false), 2000);
                    } catch (err) {
                        console.error('Fallback: Oops, unable to copy', err);
                    }
                    document.body.removeChild(textArea);
                }
            };

            useEffect(() => {
                if (step === 3 && resultRef.current) {
                    resultRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }, [step]);

            return (
                <div className="flex flex-col min-h-screen relative">
                    {/* Modals */}
                    {showResetModal && (
                        <div className="fixed inset-0 bg-black/70 z-[60] flex items-center justify-center p-4">
                            <div className="bg-slate-800 rounded-xl border border-slate-700 p-6 max-w-sm w-full shadow-2xl animate-fade-in">
                                <h3 className="text-lg font-bold text-white mb-2 flex items-center">
                                    <Icons.AlertCircle className="w-5 h-5 text-amber-400 mr-2" /> 确认重置?
                                </h3>
                                <p className="text-slate-400 text-sm mb-6">这将清除当前的评估结果和所有输入数据，无法撤销。</p>
                                <div className="flex justify-end gap-3">
                                    <button onClick={() => setShowResetModal(false)} className="px-4 py-2 text-sm text-slate-300 hover:text-white transition-colors">取消</button>
                                    <button onClick={confirmReset} className="px-4 py-2 text-sm bg-red-600 hover:bg-red-500 text-white rounded-lg transition-colors">确定重置</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showShareModal && (
                        <div className="fixed inset-0 bg-black/70 z-[60] flex items-center justify-center p-4">
                            <div className="bg-slate-800 rounded-xl border border-slate-700 p-6 max-w-md w-full shadow-2xl animate-fade-in">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold text-white flex items-center">
                                        <Icons.Share2 className="w-5 h-5 text-blue-400 mr-2" /> 分享报告
                                    </h3>
                                    <button onClick={() => setShowShareModal(false)} className="text-slate-400 hover:text-white"><Icons.X className="w-5 h-5"/></button>
                                </div>
                                <p className="text-slate-400 text-sm mb-4">复制下方链接，邀请同学来看你的职业规划：</p>
                                <div className="flex gap-2">
                                    <input type="text" readOnly value={window.location.href} className="w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-sm text-slate-300 outline-none" />
                                    <button onClick={() => copyToClipboard(window.location.href)} className="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center transition-colors min-w-[80px] justify-center">
                                        {isCopied ? <Icons.Check className="w-4 h-4" /> : <Icons.Copy className="w-4 h-4" />}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <nav className="border-b border-slate-800 bg-slate-900/80 backdrop-blur-md sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex items-center justify-between h-16">
                                <div className="flex items-center gap-2">
                                    <Icons.Sparkles className="w-6 h-6 text-emerald-400" />
                                    <span className="font-bold text-xl tracking-wider text-white">FutureCareer<span className="text-emerald-400">.AI</span></span>
                                </div>
                                <div className="hidden md:flex items-center space-x-4">
                                    <div className="flex items-center gap-2 text-xs text-slate-400 bg-slate-800 px-3 py-1 rounded-full border border-slate-700">
                                        <div className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                                        DeepSeek-R1 引擎已连接
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <div className="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
                        <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-900/10 rounded-full blur-[120px]"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-emerald-900/10 rounded-full blur-[120px]"></div>
                    </div>

                    <main className="flex-grow relative z-10 max-w-7xl mx-auto px-4 py-8 md:py-12 w-full">
                        <header className="text-center mb-12">
                            <div className="inline-flex items-center justify-center p-2 bg-emerald-500/10 rounded-full mb-4 ring-1 ring-emerald-500/20 backdrop-blur-md">
                                <Icons.Target className="w-4 h-4 text-emerald-400 mr-2" />
                                <span className="text-emerald-200 font-medium tracking-wide text-xs">Based on WEF 2025 Reports</span>
                            </div>
                            <h1 className="text-3xl md:text-6xl font-extrabold text-white mb-4 tracking-tight">
                                AI 职业发展规划镜
                            </h1>
                            <p className="text-slate-400 text-lg max-w-2xl mx-auto">
                                基于全球产业数据的深度逻辑推演，为你寻找 2035 年最具潜力的生态位。
                            </p>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                            <section className={`lg:col-span-4 bg-slate-800 border border-slate-700 rounded-2xl p-6 shadow-2xl transition-all duration-500 ${step === 3 ? 'hidden lg:block lg:opacity-60' : ''}`}>
                                <div className="flex items-center justify-between mb-6 pb-4 border-b border-slate-700">
                                    <div className="flex items-center gap-2">
                                        <Icons.User className="w-5 h-5 text-blue-400" />
                                        <h2 className="text-lg font-bold text-white">职业素质评估</h2>
                                    </div>
                                    {step === 1 && (
                                        <button onClick={handleMagicFill} className="text-xs flex items-center gap-1 bg-indigo-500/20 text-indigo-300 px-2 py-1 rounded hover:bg-indigo-500/30 transition-colors" title="自动填入测试数据">
                                            <Icons.Wand2 className="w-3 h-3" /> 试一试
                                        </button>
                                    )}
                                </div>
                                
                                <div className="space-y-5">
                                    <div className="bg-amber-900/20 p-4 rounded-lg border border-amber-700/30">
                                        <div className="text-xs text-amber-200/90 flex items-start leading-relaxed gap-2">
                                            <Icons.ShieldAlert className="w-4 h-4 mt-0.5 shrink-0" />
                                            <span><b>AI 提示：</b> 请输入具体的行为细节。生理本能（吃喝睡）将被系统自动过滤。</span>
                                        </div>
                                    </div>

                                    {[
                                        {id: 'subjects', label: '优势学科 (基础能力)', ph: '例如：物理（力学）、地理'},
                                        {id: 'hobbies', label: '深度爱好 (自驱力)', ph: '例如：编程、研究模型'},
                                    ].map(field => (
                                        <div key={field.id}>
                                            <label className="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1 block">{field.label}</label>
                                            <input type="text" name={field.id} value={inputs[field.id]} onChange={handleInputChange} placeholder={field.ph} className="w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2.5 text-sm text-white focus:ring-1 focus:ring-emerald-500 outline-none" />
                                        </div>
                                    ))}

                                    <div>
                                        <label className="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1 block">解决过的复杂问题 (核心)</label>
                                        <textarea name="problem" value={inputs.problem} onChange={handleInputChange} placeholder="关键项！请描述一次你解决困难的具体过程。" className="w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2.5 text-sm text-white focus:ring-1 focus:ring-emerald-500 outline-none h-24 resize-none"></textarea>
                                    </div>

                                    <div className="grid grid-cols-2 gap-3">
                                        {[
                                            {id: 'superpower', label: '特长/超能力', ph: '如：逻辑严密'},
                                            {id: 'expectation', label: '职业价值观', ph: '如：社会贡献'},
                                        ].map(field => (
                                            <div key={field.id}>
                                                <label className="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1 block">{field.label}</label>
                                                <input type="text" name={field.id} value={inputs[field.id]} onChange={handleInputChange} placeholder={field.ph} className="w-full bg-slate-900 border border-slate-600 rounded-lg px-3 py-2.5 text-sm text-white focus:ring-1 focus:ring-emerald-500 outline-none" />
                                            </div>
                                        ))}
                                    </div>

                                    <button onClick={callSiliconFlowAPI} disabled={step === 2 || !inputs.problem} className="w-full mt-4 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white font-bold py-3 rounded-lg shadow-lg shadow-emerald-900/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center text-sm gap-2">
                                        {step === 2 ? (
                                            <><Icons.Loader2 className="w-4 h-4 animate-spin" /> DeepSeek 推演中...</>
                                        ) : (
                                            <><Icons.Cpu className="w-4 h-4" /> 生成职业可行性报告</>
                                        )}
                                    </button>
                                </div>
                            </section>

                            <section className="lg:col-span-8 relative min-h-[500px]">
                                {step === 1 && (
                                    <div className="h-full flex flex-col items-center justify-center text-center p-8 border border-dashed border-slate-700 rounded-2xl bg-slate-800/30">
                                        <Icons.Brain className="w-20 h-20 text-slate-600 mb-6" />
                                        <h3 className="text-xl font-bold text-slate-300 mb-2">准备好连接未来了吗？</h3>
                                        <p className="text-slate-500 max-w-sm text-sm leading-relaxed mb-6">
                                            在左侧输入你的真实数据。系统将通过 AI 算法过滤无效信息，依据产业逻辑为你匹配 2035 年的职业赛道。
                                        </p>
                                    </div>
                                )}

                                {step === 2 && (
                                    <div className="h-full flex flex-col items-center justify-center p-8 rounded-2xl bg-slate-800/50 border border-emerald-500/20">
                                        <div className="w-16 h-16 border-4 border-emerald-600/30 border-t-emerald-500 rounded-full animate-spin mb-6"></div>
                                        <h3 className="text-lg font-bold text-white mb-2">DeepSeek 正在思考...</h3>
                                        <div className="space-y-2 text-center">
                                            <p className="text-slate-400 text-xs font-mono animate-pulse">Loading WEF_Jobs_Report_2025.db...</p>
                                            <p className="text-slate-400 text-xs font-mono animate-pulse delay-75">Analyzing Semantic Logic...</p>
                                        </div>
                                    </div>
                                )}

                                {step === 4 && (
                                    <div className="h-full flex flex-col items-center justify-center p-8 rounded-2xl bg-red-900/10 border border-red-500/30 text-center">
                                        <Icons.AlertCircle className="w-12 h-12 text-red-500 mb-4 mx-auto" />
                                        <p className="text-red-300 text-sm mb-4 max-w-md whitespace-pre-wrap">{errorMsg}</p>
                                        <button onClick={() => setStep(1)} className="px-5 py-2 bg-slate-700 hover:bg-slate-600 rounded text-xs text-white transition-colors">重置连接</button>
                                    </div>
                                )}

                                {step === 3 && resultData && (
                                    <div ref={resultRef} className="space-y-6 animate-fade-in">
                                        
                                        <div className="flex flex-col sm:flex-row justify-between items-center bg-slate-800/80 backdrop-blur-sm p-4 rounded-xl border border-slate-700 sticky top-20 z-40 shadow-lg gap-4">
                                            <div className="text-sm text-emerald-400 font-bold flex items-center gap-2">
                                                <Icons.Check className="w-4 h-4" /> 报告已自动保存
                                            </div>
                                            <div className="flex gap-2 w-full sm:w-auto">
                                                <button onClick={() => setShowShareModal(true)} className="flex-1 sm:flex-none flex items-center justify-center gap-2 px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white text-xs transition-colors">
                                                    <Icons.Share2 className="w-3 h-3" /> 分享
                                                </button>
                                                <button onClick={() => setShowResetModal(true)} className="flex-1 sm:flex-none flex items-center justify-center gap-2 px-3 py-2 bg-slate-700 hover:bg-red-900/50 rounded-lg text-slate-300 hover:text-red-200 text-xs transition-colors">
                                                    <Icons.RotateCcw className="w-3 h-3" /> 重置
                                                </button>
                                            </div>
                                        </div>

                                        <div className={`rounded-xl p-6 border ${resultData.type === 'specific' ? 'bg-indigo-900/40 border-indigo-500/30' : 'bg-slate-800 border-slate-600'}`}>
                                            <div className="flex items-start gap-4">
                                                <div className="p-2 bg-white/5 rounded-lg shrink-0">
                                                    <div className={resultData.type === 'specific' ? 'text-emerald-400' : 'text-amber-400'}>
                                                        {resultData.type === 'specific' ? <Icons.Target className="w-6 h-6" /> : <Icons.AlertCircle className="w-6 h-6" />}
                                                    </div>
                                                </div>
                                                <div>
                                                    <h3 className="text-lg font-bold text-white mb-2">
                                                        {resultData.type === 'specific' ? '职业匹配可行性报告' : '输入信息需优化'}
                                                    </h3>
                                                    <p className="text-slate-300 text-sm leading-relaxed">
                                                        {resultData.message}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        {resultData.type === 'specific' && resultData.careers && (
                                            <div className="grid grid-cols-1 gap-6">
                                                {resultData.careers.map((career, index) => (
                                                    <div key={index} className="bg-slate-800 rounded-xl overflow-hidden border border-slate-700 hover:border-emerald-500/50 transition-all duration-300 shadow-xl">
                                                        <div className="bg-slate-900/60 p-5 border-b border-slate-700">
                                                            <div className="flex items-center justify-between mb-2">
                                                                <h4 className="text-xl font-bold text-white flex items-center gap-2">
                                                                    <span className="text-emerald-500">#{index + 1}</span> 
                                                                    {career.title}
                                                                </h4>
                                                                <span className="px-2 py-1 rounded text-xs font-bold bg-emerald-900/30 text-emerald-300 border border-emerald-800 uppercase tracking-wider flex items-center gap-1">
                                                                    <Icons.TrendingUp className="w-3 h-3" />
                                                                    匹配度: {career.score || "High"}
                                                                </span>
                                                            </div>
                                                            <p className="text-sm text-slate-400">{career.desc}</p>
                                                        </div>

                                                        <div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                                                            <div className="space-y-4">
                                                                <div className="bg-slate-700/20 p-4 rounded-lg border border-slate-600/30">
                                                                    <h5 className="text-blue-400 font-bold mb-2 flex items-center gap-2 text-xs uppercase">
                                                                        <Icons.Heart className="w-3 h-3 shrink-0" /> 技能迁移逻辑
                                                                    </h5>
                                                                    <p className="text-xs text-slate-300 leading-relaxed">{career.matchReason}</p>
                                                                </div>
                                                                <div className="bg-slate-700/20 p-4 rounded-lg border border-slate-600/30">
                                                                    <h5 className="text-emerald-400 font-bold mb-2 flex items-center gap-2 text-xs uppercase">
                                                                        <Icons.CheckCircle2 className="w-3 h-3 shrink-0" /> 核心胜任力锚点
                                                                    </h5>
                                                                    <p className="text-xs text-slate-300 leading-relaxed">{career.strengthMatch}</p>
                                                                </div>
                                                            </div>
                                                            <div className="space-y-4">
                                                                <div className="bg-slate-700/20 p-4 rounded-lg border border-slate-600/30">
                                                                    <h5 className="text-amber-400 font-bold mb-2 flex items-center gap-2 text-xs uppercase">
                                                                        <Icons.TrendingUp className="w-3 h-3 shrink-0" /> 行业急需技能
                                                                    </h5>
                                                                    <p className="text-xs text-slate-300 leading-relaxed">{career.growth}</p>
                                                                </div>
                                                                <div className="bg-slate-700/20 p-4 rounded-lg border border-slate-600/30">
                                                                    <h5 className="text-purple-400 font-bold mb-2 flex items-center gap-2 text-xs uppercase">
                                                                        <Icons.Map className="w-3 h-3 shrink-0" /> 可行起步动作
                                                                    </h5>
                                                                    <p className="text-xs text-slate-300 leading-relaxed">{career.path}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                )}
                            </section>
                        </div>
                    </main>

                    <footer className="border-t border-slate-800 bg-slate-900/50 mt-auto py-8">
                        <div className="max-w-7xl mx-auto px-4 text-center text-slate-500 text-sm">
                            <p>© 2026 AI 职业探险家 | Powered by SiliconFlow & DeepSeek-R1</p>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

